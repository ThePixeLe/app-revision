<!--
  evaluation.component.html

  Template de la page Auto-√©valuation.

  Deux modes :
  1. Mode Liste : Affiche les chapitres √† √©valuer
  2. Mode √âdition : Formulaire d'√©valuation d'un chapitre

  Auteur: H1m0t3p3
  Date: 24 d√©cembre 2024
-->

<div class="evaluation-container">

  <!-- ========================================== -->
  <!-- MODE LISTE -->
  <!-- ========================================== -->
  <ng-container *ngIf="!isEditMode">

    <!-- Header -->
    <header class="evaluation-header">
      <div class="header-content">
        <h1 class="page-title">üìù Auto-√©valuation</h1>
        <p class="page-subtitle">
          Fais le point sur ta compr√©hension de chaque chapitre
        </p>
      </div>

      <!-- Stats -->
      <div class="header-stats">
        <div class="stat-item">
          <span class="stat-value">{{ stats.averageScore }}/10</span>
          <span class="stat-label">Moyenne</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ stats.totalEvaluations }}</span>
          <span class="stat-label">√âvaluations</span>
        </div>
        <div class="stat-item warning" *ngIf="stats.chaptersToReview > 0">
          <span class="stat-value">{{ stats.chaptersToReview }}</span>
          <span class="stat-label">√Ä revoir</span>
        </div>
      </div>
    </header>

    <!-- Onglets de cat√©gorie -->
    <nav class="category-tabs">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'all'"
        (click)="setActiveTab('all')">
        Tous
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'algebre'"
        (click)="setActiveTab('algebre')">
        üîµ Alg√®bre
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'algo'"
        (click)="setActiveTab('algo')">
        üü£ Algorithmique
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'java'"
        (click)="setActiveTab('java')">
        üü¢ Java
      </button>
    </nav>

    <!-- Liste des chapitres -->
    <div class="chapters-list">
      <article
        *ngFor="let chapter of getFilteredChapters()"
        class="chapter-card"
        [class.evaluated]="chapter.hasEvaluation"
        (click)="startEvaluation(chapter)">

        <!-- Badge cat√©gorie -->
        <span
          class="category-badge"
          [style.background]="getCategoryColor(chapter.category)">
          {{ getCategoryIcon(chapter.category) }}
        </span>

        <!-- Contenu -->
        <div class="chapter-content">
          <h3 class="chapter-name">{{ chapter.name }}</h3>
          <div class="chapter-topics">
            <span *ngFor="let topic of chapter.topics" class="topic-tag">
              {{ topic }}
            </span>
          </div>
        </div>

        <!-- Score ou bouton -->
        <div class="chapter-action">
          <div *ngIf="chapter.hasEvaluation" class="score-display" [class]="getScoreClass(chapter.lastScore || 0)">
            <span class="score-value">{{ chapter.lastScore }}/10</span>
            <span class="score-label">Modifier</span>
          </div>
          <div *ngIf="!chapter.hasEvaluation" class="eval-prompt">
            <span class="prompt-icon">‚úèÔ∏è</span>
            <span class="prompt-text">√âvaluer</span>
          </div>
        </div>

      </article>
    </div>

    <!-- Section explicative -->
    <section class="info-section">
      <h2>üí° Pourquoi s'auto-√©valuer ?</h2>
      <div class="info-content">
        <p>
          L'auto-√©valuation d√©veloppe la <strong>m√©tacognition</strong> :
          la capacit√© √† comprendre comment tu apprends.
        </p>
        <ul>
          <li>‚úÖ Identifie ce que tu ma√Ætrises d√©j√†</li>
          <li>‚ö†Ô∏è Rep√®re les points √† revoir</li>
          <li>üí¨ Note tes questions pour le formateur</li>
          <li>üìà Suis ta progression au fil du temps</li>
        </ul>
      </div>
    </section>

  </ng-container>

  <!-- ========================================== -->
  <!-- MODE √âDITION (Formulaire) -->
  <!-- ========================================== -->
  <ng-container *ngIf="isEditMode && currentChapter">

    <!-- Header formulaire -->
    <header class="form-header">
      <button class="back-btn" (click)="cancelEdit()">
        ‚Üê Retour
      </button>
      <div class="form-title">
        <span
          class="category-badge"
          [style.background]="getCategoryColor(currentChapter.category)">
          {{ getCategoryIcon(currentChapter.category) }}
        </span>
        <h1>{{ currentChapter.name }}</h1>
      </div>
    </header>

    <form class="evaluation-form" (ngSubmit)="saveEvaluation()">

      <!-- ===== NOTE GLOBALE ===== -->
      <section class="form-section">
        <h2>üìä Note globale</h2>
        <p class="section-hint">
          Sur une √©chelle de 1 √† 10, comment √©values-tu ta compr√©hension ?
        </p>

        <div class="score-input">
          <input
            type="range"
            min="1"
            max="10"
            step="1"
            [(ngModel)]="evaluationForm.score"
            name="score"
            class="score-slider">
          <div class="score-display-large" [class]="getScoreClass(evaluationForm.score)">
            {{ evaluationForm.score }}/10
          </div>
        </div>

        <div class="score-legend">
          <span>1 = Pas compris</span>
          <span>5 = Compris les bases</span>
          <span>10 = Ma√Ætrise totale</span>
        </div>
      </section>

      <!-- ===== POINTS MA√éTRIS√âS ===== -->
      <section class="form-section">
        <h2>‚úÖ Ce que je ma√Ætrise</h2>
        <p class="section-hint">
          Liste les concepts que tu as bien compris
        </p>

        <!-- Suggestions bas√©es sur les topics du chapitre -->
        <div class="topic-suggestions">
          <span class="suggestions-label">Suggestions :</span>
          <button
            *ngFor="let topic of currentChapter.topics"
            type="button"
            class="suggestion-btn"
            [class.selected]="evaluationForm.mastered.includes(topic)"
            (click)="evaluationForm.mastered.includes(topic) ? null : evaluationForm.mastered.push(topic)">
            {{ topic }}
          </button>
        </div>

        <!-- Liste des items -->
        <ul class="item-list">
          <li *ngFor="let item of evaluationForm.mastered; let i = index">
            <span>{{ item }}</span>
            <button type="button" class="remove-btn" (click)="removeMasteredItem(i)">‚úï</button>
          </li>
        </ul>

        <!-- Ajout personnalis√© -->
        <div class="add-item">
          <input
            type="text"
            placeholder="Ajouter un point ma√Ætris√©..."
            [(ngModel)]="newMasteredItem"
            name="newMastered"
            (keyup.enter)="addMasteredItem()">
          <button type="button" class="add-btn" (click)="addMasteredItem()">+</button>
        </div>
      </section>

      <!-- ===== POINTS √Ä REVOIR ===== -->
      <section class="form-section warning">
        <h2>‚ö†Ô∏è Ce que je dois revoir</h2>
        <p class="section-hint">
          Liste les concepts qui restent flous ou difficiles
        </p>

        <!-- Liste des items -->
        <ul class="item-list">
          <li *ngFor="let item of evaluationForm.toReview; let i = index">
            <span>{{ item }}</span>
            <button type="button" class="remove-btn" (click)="removeToReviewItem(i)">‚úï</button>
          </li>
        </ul>

        <!-- Ajout -->
        <div class="add-item">
          <input
            type="text"
            placeholder="Ajouter un point √† revoir..."
            [(ngModel)]="newToReviewItem"
            name="newToReview"
            (keyup.enter)="addToReviewItem()">
          <button type="button" class="add-btn" (click)="addToReviewItem()">+</button>
        </div>
      </section>

      <!-- ===== QUESTIONS ===== -->
      <section class="form-section questions">
        <h2>üí¨ Questions pour le formateur</h2>
        <p class="section-hint">
          Note les questions √† poser lors de la prochaine session
        </p>

        <div class="questions-list">
          <div
            *ngFor="let question of evaluationForm.questionsForTeacher; let i = index; trackBy: trackByIndex"
            class="question-item">
            <span class="question-number">Q{{ i + 1 }}</span>
            <input
              type="text"
              placeholder="Ta question..."
              [(ngModel)]="evaluationForm.questionsForTeacher[i]"
              [name]="'question' + i">
            <button
              type="button"
              class="remove-btn"
              *ngIf="evaluationForm.questionsForTeacher.length > 1"
              (click)="removeQuestionField(i)">
              ‚úï
            </button>
          </div>
        </div>

        <button type="button" class="add-question-btn" (click)="addQuestionField()">
          + Ajouter une question
        </button>
      </section>

      <!-- ===== NOTES ===== -->
      <section class="form-section">
        <h2>üìù Notes personnelles</h2>
        <textarea
          class="notes-input"
          placeholder="Autres remarques, r√©flexions, ressources utiles..."
          [(ngModel)]="evaluationForm.notes"
          name="notes"
          rows="4">
        </textarea>
      </section>

      <!-- ===== ACTIONS ===== -->
      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="cancelEdit()">
          Annuler
        </button>
        <button type="submit" class="btn-save">
          üíæ Sauvegarder l'√©valuation
        </button>
      </div>

    </form>

  </ng-container>

</div>

<!--
  R√©flexions UX (style David J. Malan)
  ====================================

  1. POURQUOI un slider pour la note ?

     INTUITIF :
     Glisser de 1 √† 10 est plus naturel que taper un chiffre.
     Tu SENS ta progression sur l'√©chelle.

  2. POURQUOI des suggestions de topics ?

     AIDE √Ä LA R√âFLEXION :
     Les topics du chapitre servent de "prompts".
     √áa aide √† ne rien oublier dans l'√©valuation.

  3. POURQUOI s√©parer ma√Ætris√©/√† revoir ?

     CLART√â :
     Une seule liste serait confuse.
     Deux listes = deux intentions claires.

  4. POURQUOI les questions num√©rot√©es ?

     ORGANISATION :
     Q1, Q2, Q3... C'est plus facile √† r√©f√©rencer
     lors de la discussion avec le formateur.
-->
