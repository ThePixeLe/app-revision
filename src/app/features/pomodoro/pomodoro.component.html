<!--
  pomodoro.component.html

  Template du composant POMODORO - Timer de productivit√©.

  Structure de la page :
  =====================
  1. Header avec titre et param√®tres
  2. Timer circulaire (√©l√©ment principal)
  3. Contr√¥les (play, pause, stop, skip)
  4. Indicateurs de progression (4 cercles)
  5. Statistiques du jour
  6. Panneau de configuration (modal)

  Design inspir√© de :
  - Forest App (le timer circulaire)
  - Pomofocus.io (la simplicit√©)
  - Apple Watch (les cercles d'activit√©)

  Philosophie David J. Malan :
  "Good design is invisible. You don't notice it until it's gone."

  L'interface doit √™tre tellement intuitive que l'utilisateur
  n'a pas besoin de r√©fl√©chir pour l'utiliser.

  Auteur: H1m0t3p3
  Date: 24 d√©cembre 2024
-->

<div class="pomodoro-container" [class]="'state-' + state">

  <!-- ========================================== -->
  <!-- HEADER -->
  <!-- ========================================== -->

  <header class="pomodoro-header">
    <h1 class="page-title">
      <span class="title-icon">üçÖ</span>
      Pomodoro Timer
    </h1>

    <button
      class="settings-btn"
      (click)="toggleSettings()"
      [class.active]="showSettings"
      aria-label="Param√®tres">
      ‚öôÔ∏è
    </button>
  </header>

  <!-- ========================================== -->
  <!-- MESSAGE MOTIVANT -->
  <!-- ========================================== -->

  <div class="motivational-message">
    {{ getMotivationalMessage() }}
  </div>

  <!-- ========================================== -->
  <!-- TIMER PRINCIPAL -->
  <!-- ========================================== -->

  <!--
    Le timer est l'√©l√©ment central de la page.
    Un grand cercle avec le temps restant au centre.

    Le cercle se "vide" progressivement gr√¢ce √† un conic-gradient CSS.
  -->
  <div class="timer-section">
    <div class="timer-circle" [class]="'timer-' + getStateColor()">
      <!--
        Cercle de progression.
        Utilise conic-gradient pour cr√©er l'effet de remplissage.
      -->
      <div
        class="progress-ring"
        [style.background]="getProgressStyle()">
      </div>

      <!-- Contenu int√©rieur du cercle -->
      <div class="timer-content">
        <!-- Label de l'√©tat (Focus, Pause, etc.) -->
        <span class="timer-state">{{ getStateLabel() }}</span>

        <!-- Temps restant en grand -->
        <span class="timer-display">{{ formatTime(timeRemaining) }}</span>

        <!-- Sous-label -->
        <span class="timer-sublabel" *ngIf="isActive()">
          {{ state === 'working' ? 'Reste concentr√© !' : 'D√©tends-toi...' }}
        </span>
      </div>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- INDICATEURS DE POMODORO -->
  <!-- ========================================== -->

  <!--
    4 petits cercles repr√©sentant le cycle de 4 Pomodoros.
    Remplis = Pomodoros compl√©t√©s dans ce cycle.
    Apr√®s 4, pause longue puis reset.
  -->
  <div class="pomodoro-indicators">
    <div
      *ngFor="let completed of getPomodoroIndicators(); let i = index"
      class="indicator"
      [class.completed]="completed"
      [attr.aria-label]="'Pomodoro ' + (i + 1) + (completed ? ' (compl√©t√©)' : '')">
      üçÖ
    </div>
    <span class="cycle-label">
      Cycle : {{ completedPomodoros % 4 }}/4
    </span>
  </div>

  <!-- ========================================== -->
  <!-- CONTR√îLES -->
  <!-- ========================================== -->

  <div class="controls-section">
    <!--
      √âtat IDLE (pas de timer actif)
      Affiche les 3 boutons de d√©marrage.
    -->
    <div *ngIf="state === 'idle'" class="controls-idle">
      <button
        class="control-btn btn-primary btn-large"
        (click)="startPomodoro()">
        <span class="btn-icon">‚ñ∂Ô∏è</span>
        <span class="btn-text">D√©marrer un Pomodoro</span>
      </button>

      <div class="secondary-controls">
        <button
          class="control-btn btn-secondary"
          (click)="startShortBreak()">
          <span class="btn-icon">‚òï</span>
          <span class="btn-text">Pause courte</span>
        </button>

        <button
          class="control-btn btn-secondary"
          (click)="startLongBreak()">
          <span class="btn-icon">üå¥</span>
          <span class="btn-text">Pause longue</span>
        </button>
      </div>
    </div>

    <!--
      √âtat ACTIF (timer en cours)
      Affiche pause/stop/skip.
    -->
    <div *ngIf="isActive() || state === 'paused'" class="controls-active">
      <button
        class="control-btn btn-icon-only"
        (click)="stop()"
        aria-label="Arr√™ter">
        ‚èπÔ∏è
      </button>

      <button
        class="control-btn btn-primary btn-large"
        (click)="togglePause()">
        <span class="btn-icon">{{ state === 'paused' ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è' }}</span>
        <span class="btn-text">{{ state === 'paused' ? 'Reprendre' : 'Pause' }}</span>
      </button>

      <button
        class="control-btn btn-icon-only"
        (click)="skip()"
        aria-label="Passer">
        ‚è≠Ô∏è
      </button>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- STATISTIQUES DU JOUR -->
  <!-- ========================================== -->

  <section class="stats-section" *ngIf="stats">
    <h2 class="section-title">Statistiques</h2>

    <div class="stats-grid">
      <!-- Aujourd'hui -->
      <div class="stat-card">
        <span class="stat-icon">üìÖ</span>
        <div class="stat-content">
          <span class="stat-value">{{ stats.today.completed }}</span>
          <span class="stat-label">Pomodoros aujourd'hui</span>
        </div>
      </div>

      <!-- Temps de travail -->
      <div class="stat-card">
        <span class="stat-icon">‚è±Ô∏è</span>
        <div class="stat-content">
          <span class="stat-value">{{ stats.today.totalWorkTime }} min</span>
          <span class="stat-label">Temps de focus</span>
        </div>
      </div>

      <!-- Cette semaine -->
      <div class="stat-card">
        <span class="stat-icon">üìÜ</span>
        <div class="stat-content">
          <span class="stat-value">{{ stats.thisWeek.completed }}</span>
          <span class="stat-label">Cette semaine</span>
        </div>
      </div>

      <!-- Total -->
      <div class="stat-card">
        <span class="stat-icon">üèÜ</span>
        <div class="stat-content">
          <span class="stat-value">{{ stats.allTime.completed }}</span>
          <span class="stat-label">Total Pomodoros</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ========================================== -->
  <!-- PANNEAU DE CONFIGURATION -->
  <!-- ========================================== -->

  <!--
    Panneau lat√©ral pour configurer les dur√©es.
    S'affiche quand showSettings = true.
  -->
  <div class="settings-panel" [class.open]="showSettings">
    <div class="settings-overlay" (click)="toggleSettings()"></div>

    <div class="settings-content">
      <header class="settings-header">
        <h2>Param√®tres</h2>
        <button class="close-btn" (click)="toggleSettings()">‚úï</button>
      </header>

      <div class="settings-body">
        <!-- Dur√©e de travail -->
        <div class="setting-item">
          <label class="setting-label">
            <span class="setting-icon">üçÖ</span>
            Dur√©e de travail
          </label>
          <div class="setting-control">
            <button
              class="adjust-btn"
              (click)="updateWorkDuration(config.workDuration / 60 - 5)"
              [disabled]="config.workDuration <= 15 * 60">
              ‚àí
            </button>
            <span class="setting-value">{{ config.workDuration / 60 }} min</span>
            <button
              class="adjust-btn"
              (click)="updateWorkDuration(config.workDuration / 60 + 5)"
              [disabled]="config.workDuration >= 60 * 60">
              +
            </button>
          </div>
        </div>

        <!-- Dur√©e pause courte -->
        <div class="setting-item">
          <label class="setting-label">
            <span class="setting-icon">‚òï</span>
            Pause courte
          </label>
          <div class="setting-control">
            <button
              class="adjust-btn"
              (click)="updateShortBreakDuration(config.shortBreakDuration / 60 - 1)"
              [disabled]="config.shortBreakDuration <= 3 * 60">
              ‚àí
            </button>
            <span class="setting-value">{{ config.shortBreakDuration / 60 }} min</span>
            <button
              class="adjust-btn"
              (click)="updateShortBreakDuration(config.shortBreakDuration / 60 + 1)"
              [disabled]="config.shortBreakDuration >= 15 * 60">
              +
            </button>
          </div>
        </div>

        <!-- Dur√©e pause longue -->
        <div class="setting-item">
          <label class="setting-label">
            <span class="setting-icon">üå¥</span>
            Pause longue
          </label>
          <div class="setting-control">
            <button
              class="adjust-btn"
              (click)="updateLongBreakDuration(config.longBreakDuration / 60 - 5)"
              [disabled]="config.longBreakDuration <= 10 * 60">
              ‚àí
            </button>
            <span class="setting-value">{{ config.longBreakDuration / 60 }} min</span>
            <button
              class="adjust-btn"
              (click)="updateLongBreakDuration(config.longBreakDuration / 60 + 5)"
              [disabled]="config.longBreakDuration >= 45 * 60">
              +
            </button>
          </div>
        </div>

        <hr class="settings-divider">

        <!-- Auto-start pauses -->
        <div class="setting-item setting-toggle">
          <label class="setting-label">
            <span class="setting-icon">‚è∞</span>
            D√©marrer les pauses automatiquement
          </label>
          <button
            class="toggle-btn"
            [class.active]="config.autoStartBreaks"
            (click)="toggleAutoStartBreaks()">
            {{ config.autoStartBreaks ? 'ON' : 'OFF' }}
          </button>
        </div>

        <!-- Auto-start Pomodoros -->
        <div class="setting-item setting-toggle">
          <label class="setting-label">
            <span class="setting-icon">üîÑ</span>
            D√©marrer les Pomodoros automatiquement
          </label>
          <button
            class="toggle-btn"
            [class.active]="config.autoStartPomodoros"
            (click)="toggleAutoStartPomodoros()">
            {{ config.autoStartPomodoros ? 'ON' : 'OFF' }}
          </button>
        </div>

        <hr class="settings-divider">

        <!-- Bouton reset -->
        <button class="reset-btn" (click)="resetConfig()">
          üîÑ R√©initialiser les param√®tres
        </button>
      </div>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- CONSEILS -->
  <!-- ========================================== -->

  <section class="tips-section">
    <h3 class="tips-title">üí° Conseils pour un Pomodoro efficace</h3>
    <ul class="tips-list">
      <li>√âlimine les distractions : t√©l√©phone en silencieux, notifications off</li>
      <li>Pr√©pare tout avant : eau, documents, outils n√©cessaires</li>
      <li>Une t√¢che √† la fois : pas de multit√¢che pendant le Pomodoro</li>
      <li>Respecte les pauses : elles sont essentielles pour la r√©cup√©ration</li>
      <li>Note tes interruptions : √ßa t'aidera √† les r√©duire</li>
    </ul>
  </section>

</div>
